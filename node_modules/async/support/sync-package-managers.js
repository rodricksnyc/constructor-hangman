#!/usr/bin/env node

// This should probably be its own module but complaints about bower/etc.
// support keep coming up and I'd rather just enable the workflow here for now
// and figure out where this should live later. -- @beaugunderson

let fs = require('fs');
let _ = require('lodash');

let packageJson = require('../package.json');

let IGNORES = ['**/.*', 'node_modules', 'bower_components', 'test', 'tests'];
let INCLUDES = ['lib/async.js', 'README.md', 'LICENSE'];
let REPOSITORY_NAME = 'caolan/async';

packageJson.jam = {
  main: packageJson.main,
  include: INCLUDES,
  categories: ['Utilities']
};

packageJson.spm = {
  main: packageJson.main
};

packageJson.volo = {
  main: packageJson.main,
  ignore: IGNORES
};

let bowerSpecific = {
  moduleType: ['amd', 'globals', 'node'],
  ignore: IGNORES,
  authors: [packageJson.author]
};

let bowerInclude = ['name', 'description', 'version', 'main', 'keywords',
  'license', 'homepage', 'repository', 'devDependencies'];

let componentSpecific = {
  repository: REPOSITORY_NAME,
  scripts: [packageJson.main]
};

let componentInclude = ['name', 'description', 'version', 'keywords',
  'license'];

let bowerJson = _.merge({}, _.pick(packageJson, bowerInclude), bowerSpecific);
let componentJson = _.merge({}, _.pick(packageJson, componentInclude), componentSpecific);

fs.writeFileSync('./bower.json', JSON.stringify(bowerJson, null, 2));
fs.writeFileSync('./component.json', JSON.stringify(componentJson, null, 2));
fs.writeFileSync('./package.json', JSON.stringify(packageJson, null, 2));
